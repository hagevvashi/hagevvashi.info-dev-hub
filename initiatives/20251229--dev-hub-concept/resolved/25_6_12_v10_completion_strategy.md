# v10è¨­è¨ˆå®Œæˆæˆ¦ç•¥: s6-overlayçµ±åˆã®æœ€çµ‚1%å®Ÿè£…

**ä½œæˆæ—¥**: 2026-01-09
**ç›®çš„**: v10è¨­è¨ˆï¼ˆs6-overlayã‚’PID 1ã¨ã—ã¦ä½¿ç”¨ï¼‰ã®æ®‹ã‚Š1%ã®å®Ÿè£…ã‚’å®Œäº†ã—ã€Monolithic DevContainerã®ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ã‚’å®Œæˆã•ã›ã‚‹

**åŸºæº–ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- `25_0_process_management_solution.v10.md` - v10è¨­è¨ˆã®è©³ç´°
- `25_6_11_pid1_design_deviation_analysis.md` - å•é¡Œã®åˆ†æ
- `25_6_11_pid1_design_deviation_verification_tracker.md` - æ¤œè¨¼çµæœ

---

## 0. ç›®æ¨™ï¼ˆé”æˆã™ã¹ãçŠ¶æ…‹ï¼‰

### 0.1 æŠ€è¡“çš„ç›®æ¨™

**v10è¨­è¨ˆã®å®Œå…¨å®Ÿè£…**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           s6-overlay (PID 1)                â”‚
â”‚                 /init                       â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ docker-entrypoint (oneshot)         â”‚   â”‚
â”‚  â”‚ - Phase 1-5ã®åˆæœŸåŒ–å‡¦ç†             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ supervisord (longrun)               â”‚   â”‚
â”‚  â”‚ - code-server ç®¡ç†                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ process-compose (longrun)           â”‚   â”‚
â”‚  â”‚ - TUI ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 0.2 æˆåŠŸåŸºæº–

| é …ç›® | æˆåŠŸåŸºæº– | ç¢ºèªæ–¹æ³• |
|------|---------|----------|
| **PID 1** | s6-overlayï¼ˆ/initï¼‰ãŒPID 1ã¨ã—ã¦å‹•ä½œ | `docker exec <container> ps aux \| grep "^root.*1"` |
| **docker-entrypointå®Ÿè¡Œ** | Phase 1-5ãŒæ­£å¸¸ã«å®Ÿè¡Œã•ã‚Œã‚‹ | `docker logs <container>` ã§ç¢ºèª |
| **supervisordèµ·å‹•** | s6-overlayã®longrunã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦èµ·å‹• | `/command/s6-svstat /run/service/supervisord` |
| **process-composeèµ·å‹•** | s6-overlayã®longrunã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦èµ·å‹• | `/command/s6-svstat /run/service/process-compose` |
| **code-serverå‹•ä½œ** | ãƒãƒ¼ãƒˆ4035ã§æ­£å¸¸å‹•ä½œ | `curl http://localhost:4035` |
| **graceful shutdown** | SIGTERMå—ä¿¡æ™‚ã«å…¨ãƒ—ãƒ­ã‚»ã‚¹ãŒæ­£å¸¸çµ‚äº† | `docker stop <container>` ã§ãƒ­ã‚°ç¢ºèª |

---

## 1. èª²é¡Œï¼ˆç›®æ¨™ã¨ã®ã‚®ãƒ£ãƒƒãƒ—ï¼‰

### 1.1 ç¾åœ¨ã®çŠ¶æ…‹

**æ¤œè¨¼çµæœï¼ˆ25_6_11_pid1_design_deviation_verification_tracker.md ã‚»ã‚¯ã‚·ãƒ§ãƒ³B-4ï¼‰ã‚ˆã‚Š**:

- âœ… s6-overlayã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ï¼ˆDockerfile line 93-107ï¼‰
- âœ… s6-overlayã‚µãƒ¼ãƒ“ã‚¹å®šç¾©å®Œç’§ï¼ˆ`.devcontainer/s6-rc.d/`ï¼‰
- âŒ Dockerfileã®ENTRYPOINTãŒ`/usr/local/bin/docker-entrypoint.sh`ã®ã¾ã¾ï¼ˆline 299ï¼‰
- âŒ docker-entrypoint.shã®æœ€å¾Œã§`exec sudo supervisord`ã‚’å®Ÿè¡Œï¼ˆline 228-229ï¼‰

### 1.2 ã‚®ãƒ£ãƒƒãƒ—

**æ®‹ã‚Š1%ã®å®Ÿè£…**:
1. Dockerfile line 299ã®ENTRYPOINTå¤‰æ›´
2. docker-entrypoint.sh line 228-229ã®å‰Šé™¤
3. docker-entrypoint.shå†…ã®sudoå‰Šé™¤ï¼ˆs6-overlayã®oneshotã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ï¼‰

---

## 2. åŸå› 

### 2.1 ç›´æ¥çš„åŸå› 

**ä»®èª¬2ï¼ˆENTRYPOINTã®åˆ‡ã‚Šæ›¿ãˆã‚’å¿˜ã‚ŒãŸï¼‰ãŒæ­£ã—ã„**ï¼ˆæ¤œè¨¼æ¸ˆã¿ï¼‰:

- v10å®Ÿè£…ãƒˆãƒ©ãƒƒã‚«ãƒ¼ã«ã¯ã€ŒPhase 1å®Œäº†ã€ã¨è¨˜éŒ²
- ã—ã‹ã—å®Ÿéš›ã«ã¯ENTRYPOINTãŒå¤‰æ›´ã•ã‚Œã¦ã„ãªã„
- ã‚µãƒ¼ãƒ“ã‚¹å®šç¾©ã¯å®Œç’§ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹

### 2.2 æ ¹æœ¬åŸå› 

**ãƒˆãƒ©ãƒƒã‚«ãƒ¼æ›´æ–°ã¨å®Ÿè£…ã®ä¹–é›¢**:
- Phase 1ã®ã‚¿ã‚¹ã‚¯ã‚’å®Œäº†ã¨ã—ã¦ãƒãƒ¼ã‚¯ã—ãŸãŒã€å®Ÿè£…ãŒä¼´ã£ã¦ã„ãªã‹ã£ãŸ
- ã¾ãŸã¯ã€å®Ÿè£…å¾Œã«Dockerfileã‚’åˆ¥ã®ç†ç”±ã§ä¿®æ­£ã—ã€ENTRYPOINTãŒå…ƒã«æˆ»ã£ãŸ

---

## 3. ç›®çš„ï¼ˆã‚ã‚‹ã¹ãçŠ¶æ…‹ï¼‰

### 3.1 çŸ­æœŸç›®çš„

**v10è¨­è¨ˆã®å®Œå…¨å®Ÿè£…**:
- s6-overlayãŒPID 1ã¨ã—ã¦å‹•ä½œ
- docker-entrypoint.shãŒoneshotã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦å®Ÿè¡Œ
- supervisordã¨process-composeãŒlongrunã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦å‹•ä½œ

### 3.2 ä¸­æœŸç›®çš„

**å …ç‰¢ãªãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ã®å®Ÿç¾**:
- PID 1ä¿è­·ï¼ˆã‚¾ãƒ³ãƒ“ãƒ—ãƒ­ã‚»ã‚¹ã®å›åï¼‰
- graceful shutdown
- ãƒ—ãƒ­ã‚»ã‚¹ç›£è¦–ãƒ»è‡ªå‹•å†èµ·å‹•

### 3.3 é•·æœŸç›®çš„

**Monolithic DevContainerã®å®Œæˆ**:
- v10è¨­è¨ˆã®å…¨Phaseå®Œäº†
- æœ¬ç•ªç’°å¢ƒãƒ¬ãƒ™ãƒ«ã®å …ç‰¢æ€§

---

## 4. æˆ¦ç•¥ãƒ»ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼ˆè§£æ±ºã®æ–¹é‡ï¼‰

### æˆ¦ç•¥A: æœ€å°é™ã®å¤‰æ›´ã§å®Ÿè£…ï¼ˆæ¨å¥¨ï¼‰

**æ–¹é‡**: Dockerfile 1è¡Œã¨docker-entrypoint.sh 2è¡Œã®ã¿ã‚’ä¿®æ­£ã—ã€s6-overlayçµ±åˆã‚’å®Œæˆã•ã›ã‚‹

**ç†ç”±**:
- ã‚µãƒ¼ãƒ“ã‚¹å®šç¾©ã¯æ—¢ã«å®Œç’§ã«å®Ÿè£…æ¸ˆã¿
- å¤‰æ›´ç®‡æ‰€ãŒæ˜ç¢ºã§ã€ãƒªã‚¹ã‚¯ãŒä½ã„
- ã™ãã«æ¤œè¨¼å¯èƒ½

### æˆ¦ç•¥B: docker-entrypoint.shã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚‚å®Ÿæ–½

**æ–¹é‡**: ENTRYPOINTå¤‰æ›´ã«åŠ ãˆã€docker-entrypoint.shå…¨ä½“ã‚’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼ˆsudoå‰Šé™¤ã€Phase 6å‰Šé™¤ç­‰ï¼‰

**ç†ç”±**:
- ã‚ˆã‚Šè¨­è¨ˆã«å¿ å®Ÿ
- å°†æ¥çš„ãªãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§å‘ä¸Š

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
- å¤‰æ›´ç¯„å›²ãŒåºƒãŒã‚‹
- ãƒ†ã‚¹ãƒˆè² è·å¢—åŠ 

### æˆ¦ç•¥C: æ®µéšçš„å®Ÿè£…ï¼ˆPhase 6å‰Šé™¤ã¯å¾Œå›ã—ï¼‰

**æ–¹é‡**: ã¾ãšENTRYPOINTå¤‰æ›´ã®ã¿å®Ÿæ–½ã—ã€docker-entrypoint.shã®ä¿®æ­£ã¯å¾Œå›ã—

**ç†ç”±**:
- ãƒªã‚¹ã‚¯ã‚’æœ€å°åŒ–
- æ®µéšçš„æ¤œè¨¼ãŒå¯èƒ½

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
- docker-entrypoint.shã®æœ€å¾Œã§`exec sudo supervisord`ãŒæ®‹ã‚‹
- s6-overlayã®ã‚µãƒ¼ãƒ“ã‚¹å®šç¾©ã¨é‡è¤‡ã™ã‚‹å¯èƒ½æ€§

---

## 5. è§£æ±ºç­–ï¼ˆ3ã¤ã®ç•°ãªã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼‰

### è§£æ±ºç­–1: æœ€å°é™å¤‰æ›´ãƒ»å³æ™‚å®Œæˆï¼ˆæˆ¦ç•¥Aï¼‰ â˜…æ¨å¥¨â˜…

**æ¦‚è¦**: Dockerfile 1è¡Œã¨docker-entrypoint.sh 2è¡Œã®ã¿ã‚’ä¿®æ­£

#### å®Ÿæ–½å†…å®¹

##### å¤‰æ›´1: Dockerfile line 299

```dockerfile
# ä¿®æ­£å‰
ENTRYPOINT ["/usr/local/bin/docker-entrypoint.sh"]

# ä¿®æ­£å¾Œ
ENTRYPOINT ["/init"]
```

##### å¤‰æ›´2: docker-entrypoint.sh line 228-229ã‚’å‰Šé™¤

```bash
# ä¿®æ­£å‰ï¼ˆline 220-229ï¼‰
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… Container initialization complete"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸš€ Starting supervisord..."
echo ""

# supervisordã‚’ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§èµ·å‹•ï¼ˆPID 1ã¨ã—ã¦å®Ÿè¡Œï¼‰
exec sudo supervisord -c "${TARGET_CONF}" -n

# ä¿®æ­£å¾Œï¼ˆline 220-227ï¼‰
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… Container initialization complete"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "âœ… docker-entrypoint.sh finished. s6-overlay will now start services."
echo ""

# Phase 6å‰Šé™¤: s6-overlayãŒsupervisordã¨process-composeã‚’èµ·å‹•ã™ã‚‹
```

##### å¤‰æ›´3: Dockerfileã®ã‚³ãƒ¡ãƒ³ãƒˆä¿®æ­£ï¼ˆline 300-302ï¼‰

```dockerfile
# ä¿®æ­£å‰
# s6-overlay ã‚’ PID 1 ã¨ã—ã¦èµ·å‹•
# s6-overlay ãŒ docker-entrypoint, supervisord, process-compose ã‚’ç®¡ç†

# ä¿®æ­£å¾Œ
# s6-overlay ã‚’ PID 1 ã¨ã—ã¦èµ·å‹•ï¼ˆ/initï¼‰
# s6-overlay ãŒä»¥ä¸‹ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç®¡ç†:
#   - docker-entrypoint (oneshot): Phase 1-5ã®åˆæœŸåŒ–å‡¦ç†
#   - supervisord (longrun): code-serverç­‰ã®ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†
#   - process-compose (longrun): TUIãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†
```

#### ãƒ¡ãƒªãƒƒãƒˆ

- âœ… **æœ€å°é™ã®å¤‰æ›´**: 3ç®‡æ‰€ã®ã¿ã®ä¿®æ­£
- âœ… **å³åº§ã«å®Œæˆ**: v10è¨­è¨ˆãŒå®Œå…¨å®Ÿè£…ã•ã‚Œã‚‹
- âœ… **ãƒªã‚¹ã‚¯ä½**: æ—¢å­˜ã®ã‚µãƒ¼ãƒ“ã‚¹å®šç¾©ã‚’æ´»ç”¨
- âœ… **ãƒ†ã‚¹ãƒˆå®¹æ˜“**: å¤‰æ›´ç®‡æ‰€ãŒæ˜ç¢º

#### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

- âš ï¸ docker-entrypoint.shå†…ã«sudoãŒæ®‹ã‚‹ï¼ˆs6-overlayã®oneshotã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ä¸è¦ã ãŒã€å‹•ä½œã«ã¯å½±éŸ¿ã—ãªã„ï¼‰

#### é©ç”¨ã‚·ãƒ¼ãƒ³

- **ä»Šã™ãv10è¨­è¨ˆã‚’å®Œæˆã•ã›ãŸã„å ´åˆ**ï¼ˆç¾åœ¨ã®çŠ¶æ³ã«æœ€é©ï¼‰

---

### è§£æ±ºç­–2: docker-entrypoint.shãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°è¾¼ã¿ï¼ˆæˆ¦ç•¥Bï¼‰

**æ¦‚è¦**: ENTRYPOINTå¤‰æ›´ã«åŠ ãˆã€docker-entrypoint.shå…¨ä½“ã‚’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

#### å®Ÿæ–½å†…å®¹

è§£æ±ºç­–1ã«åŠ ãˆã¦:

##### è¿½åŠ å¤‰æ›´: docker-entrypoint.shå†…ã®sudoå‰Šé™¤

```bash
# ä¿®æ­£å‰ï¼ˆPhase 1ï¼‰
chown -R ${UNAME}:${GNAME} "$item"

# ä¿®æ­£å¾Œ
sudo chown -R ${UNAME}:${GNAME} "$item"

# ç†ç”±: s6-overlayã®oneshotã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã‚‹å ´åˆã€
# rootãƒ¦ãƒ¼ã‚¶ãƒ¼ã§å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚sudoã¯ä¸è¦...
# ãŸã ã—ã€wait! ã‚µãƒ¼ãƒ“ã‚¹å®šç¾©ã‚’ç¢ºèªã™ã‚‹ã¨...
```

**é‡è¦ãªç™ºè¦‹**: `.devcontainer/s6-rc.d/docker-entrypoint/up`ã‚’ç¢ºèªã™ã‚‹ã¨:

```bash
#!/command/execlineb -P
/usr/local/bin/docker-entrypoint.sh
```

**ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡å®šãŒãªã„** = ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§rootã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã‚‹å¯èƒ½æ€§ãŒé«˜ã„

**çµè«–**: sudoã¯ä¸è¦ã®å¯èƒ½æ€§ãŒé«˜ã„ãŒã€25_6_10ã§ææ¡ˆã•ã‚ŒãŸã€ŒENTRYPOINTã‚’USERå¾Œã«ç§»å‹•ã€ã¨ã®é–¢ä¿‚ã‚’æ•´ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

#### ãƒ¡ãƒªãƒƒãƒˆ

- âœ… **è¨­è¨ˆã«å¿ å®Ÿ**: sudoä¸è¦ãªç®‡æ‰€ã‚’å‰Šé™¤
- âœ… **å°†æ¥çš„ãªãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§**: ã‚³ãƒ¼ãƒ‰ãŒã‚¯ãƒªãƒ¼ãƒ³ã«ãªã‚‹

#### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

- âš ï¸ **å¤‰æ›´ç¯„å›²æ‹¡å¤§**: ãƒ†ã‚¹ãƒˆè² è·å¢—åŠ 
- âš ï¸ **25_6_10ã¨ã®æ•´åˆæ€§**: ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ‡ã‚Šæ›¿ãˆå•é¡Œã¨ã®é–¢ä¿‚ã‚’æ•´ç†ã™ã‚‹å¿…è¦

#### é©ç”¨ã‚·ãƒ¼ãƒ³

- sudoå‰Šé™¤ã‚‚åŒæ™‚ã«å®Ÿæ–½ã—ãŸã„å ´åˆ
- 25_6_10ã®å•é¡Œã‚‚åŒæ™‚ã«è§£æ±ºã—ãŸã„å ´åˆ

---

### è§£æ±ºç­–3: æ®µéšçš„å®Ÿè£…ï¼ˆæˆ¦ç•¥Cï¼‰

**æ¦‚è¦**: ã¾ãšENTRYPOINTå¤‰æ›´ã®ã¿å®Ÿæ–½ã—ã€docker-entrypoint.shã¯å¾Œå›ã—

#### å®Ÿæ–½å†…å®¹

Dockerfile line 299ã®ã¿ã‚’ä¿®æ­£:

```dockerfile
# ä¿®æ­£å‰
ENTRYPOINT ["/usr/local/bin/docker-entrypoint.sh"]

# ä¿®æ­£å¾Œ
ENTRYPOINT ["/init"]
```

docker-entrypoint.shã¯**å¤‰æ›´ã—ãªã„**ã€‚

#### å‹•ä½œäºˆæ¸¬

1. `/init` (s6-overlay) ãŒPID 1ã¨ã—ã¦èµ·å‹•
2. s6-overlayãŒ`docker-entrypoint`ã‚’oneshotã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦å®Ÿè¡Œ
3. docker-entrypoint.sh Phase 1-5ã‚’å®Ÿè¡Œ
4. docker-entrypoint.sh Phase 6ã§`exec sudo supervisord`ã‚’å®Ÿè¡Œ
5. **å•é¡Œ**: `exec`ã«ã‚ˆã‚Šãƒ—ãƒ­ã‚»ã‚¹ãŒç½®ãæ›ãˆã‚‰ã‚Œã€s6-overlayã®åˆ¶å¾¡ã‹ã‚‰å¤–ã‚Œã‚‹å¯èƒ½æ€§

#### çµè«–

**ã“ã®è§£æ±ºç­–ã¯æ©Ÿèƒ½ã—ãªã„å¯èƒ½æ€§ãŒé«˜ã„**ï¼ˆ`exec`ã®æŒ™å‹•ã«ã‚ˆã‚Šï¼‰

---

## 6. æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®é¸å®š

### æ¨å¥¨: **è§£æ±ºç­–1ï¼ˆæœ€å°é™å¤‰æ›´ãƒ»å³æ™‚å®Œæˆï¼‰**

**é¸å®šç†ç”±**:

1. **å³åŠ¹æ€§**: 3ç®‡æ‰€ã®ä¿®æ­£ã§v10è¨­è¨ˆå®Œæˆ
2. **å®‰å…¨æ€§**: æ—¢å­˜ã®ã‚µãƒ¼ãƒ“ã‚¹å®šç¾©ã‚’æ´»ç”¨ã€å¤‰æ›´ç¯„å›²ãŒæ˜ç¢º
3. **æ¤œè¨¼å®¹æ˜“æ€§**: ã™ãã«ãƒ†ã‚¹ãƒˆå¯èƒ½
4. **25_6_10ã¨ã®åˆ†é›¢**: ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ‡ã‚Šæ›¿ãˆå•é¡Œã¯åˆ¥é€”å¯¾å¿œ

**å®Ÿæ–½ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: ä»Šã™ã

---

## 7. å®Ÿè£…è¨ˆç”»ï¼ˆè§£æ±ºç­–1ã®è©³ç´°æ‰‹é †ï¼‰

### Phase 1: ã‚³ãƒ¼ãƒ‰ä¿®æ­£

#### ã‚¿ã‚¹ã‚¯1-1: Dockerfileä¿®æ­£

**ãƒ•ã‚¡ã‚¤ãƒ«**: `.devcontainer/Dockerfile`

**å¤‰æ›´ç®‡æ‰€1**: line 299

```dockerfile
# ä¿®æ­£å‰
ENTRYPOINT ["/usr/local/bin/docker-entrypoint.sh"]

# ä¿®æ­£å¾Œ
ENTRYPOINT ["/init"]
```

**å¤‰æ›´ç®‡æ‰€2**: line 300-302ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ ï¼‰

```dockerfile
# ä¿®æ­£å‰
# s6-overlay ã‚’ PID 1 ã¨ã—ã¦èµ·å‹•
# s6-overlay ãŒ docker-entrypoint, supervisord, process-compose ã‚’ç®¡ç†

# ä¿®æ­£å¾Œ
# s6-overlay ã‚’ PID 1 ã¨ã—ã¦èµ·å‹•ï¼ˆ/initï¼‰
# v10è¨­è¨ˆ: s6-overlay ãŒä»¥ä¸‹ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç®¡ç†
#   - docker-entrypoint (oneshot): åˆæœŸåŒ–å‡¦ç†ï¼ˆPhase 1-5ï¼‰
#   - supervisord (longrun): code-serverç­‰ã®ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†
#   - process-compose (longrun): TUIãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†
```

#### ã‚¿ã‚¹ã‚¯1-2: docker-entrypoint.shä¿®æ­£

**ãƒ•ã‚¡ã‚¤ãƒ«**: `.devcontainer/docker-entrypoint.sh`

**å¤‰æ›´ç®‡æ‰€**: line 220-229

```bash
# ä¿®æ­£å‰
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… Container initialization complete"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸš€ Starting supervisord..."
echo ""

# supervisordã‚’ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§èµ·å‹•ï¼ˆPID 1ã¨ã—ã¦å®Ÿè¡Œï¼‰
exec sudo supervisord -c "${TARGET_CONF}" -n

# ä¿®æ­£å¾Œ
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… Container initialization complete"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "âœ… docker-entrypoint.sh finished."
echo "   s6-overlay will now start supervisord and process-compose as longrun services."
echo ""

# Phase 6å‰Šé™¤: s6-overlayãŒsupervisordã¨process-composeã‚’èµ·å‹•ã™ã‚‹
```

### Phase 2: ãƒ“ãƒ«ãƒ‰ã¨æ¤œè¨¼

#### ã‚¿ã‚¹ã‚¯2-1: DevContainerãƒ“ãƒ«ãƒ‰

```bash
cd /Users/<ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼>/repos/<MonolithicDevContainerãƒ¬ãƒã‚¸ãƒˆãƒªå>/.devcontainer

# ãƒ“ãƒ«ãƒ‰ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã—ï¼‰
docker compose --progress plain -f docker-compose.yml -f docker-compose.dev-vm.yml build --no-cache
```

**æœŸå¾…çµæœ**: ã‚¨ãƒ©ãƒ¼ãªããƒ“ãƒ«ãƒ‰å®Œäº†

#### ã‚¿ã‚¹ã‚¯2-2: ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•

```bash
# æ—¢å­˜ã‚³ãƒ³ãƒ†ãƒŠå‰Šé™¤
docker compose -f docker-compose.yml -f docker-compose.dev-vm.yml down

# èµ·å‹•
docker compose --project-name <MonolithicDevContainerãƒ¬ãƒã‚¸ãƒˆãƒªå>_devcontainer \
  -f docker-compose.yml -f docker-compose.dev-vm.yml up -d
```

**æœŸå¾…çµæœ**: ã‚¨ãƒ©ãƒ¼ãªãèµ·å‹•

#### ã‚¿ã‚¹ã‚¯2-3: PID 1ç¢ºèª

```bash
docker exec <MonolithicDevContainerãƒ¬ãƒã‚¸ãƒˆãƒªå>_devcontainer-dev-1 ps aux | head -n 10
```

**æœŸå¾…çµæœ**:
```
USER       PID  COMMAND
root         1  s6-svscan /run/service
```

#### ã‚¿ã‚¹ã‚¯2-4: ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ç¢ºèª

```bash
docker exec <MonolithicDevContainerãƒ¬ãƒã‚¸ãƒˆãƒªå>_devcontainer-dev-1 /command/s6-rc -a list
```

**æœŸå¾…çµæœ**: `docker-entrypoint`, `supervisord`, `process-compose` ãŒè¡¨ç¤ºã•ã‚Œã‚‹

```bash
docker exec <MonolithicDevContainerãƒ¬ãƒã‚¸ãƒˆãƒªå>_devcontainer-dev-1 /command/s6-svstat /run/service/supervisord
docker exec <MonolithicDevContainerãƒ¬ãƒã‚¸ãƒˆãƒªå>_devcontainer-dev-1 /command/s6-svstat /run/service/process-compose
```

**æœŸå¾…çµæœ**: ä¸¡æ–¹ã¨ã‚‚`up`çŠ¶æ…‹

#### ã‚¿ã‚¹ã‚¯2-5: docker-entrypoint.shå®Ÿè¡Œç¢ºèª

```bash
docker logs <MonolithicDevContainerãƒ¬ãƒã‚¸ãƒˆãƒªå>_devcontainer-dev-1 2>&1 | grep "Phase"
```

**æœŸå¾…çµæœ**: Phase 1-5ã®å®Ÿè¡Œãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã‚‹

#### ã‚¿ã‚¹ã‚¯2-6: code-serverå‹•ä½œç¢ºèª

```bash
curl -I http://localhost:4035
```

**æœŸå¾…çµæœ**: HTTP 200ã¾ãŸã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

#### ã‚¿ã‚¹ã‚¯2-7: graceful shutdownç¢ºèª

```bash
docker stop <MonolithicDevContainerãƒ¬ãƒã‚¸ãƒˆãƒªå>_devcontainer-dev-1
docker logs <MonolithicDevContainerãƒ¬ãƒã‚¸ãƒˆãƒªå>_devcontainer-dev-1 2>&1 | tail -n 20
```

**æœŸå¾…çµæœ**: s6-overlayã«ã‚ˆã‚‹æ­£å¸¸ãªã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ãƒ­ã‚°

### Phase 3: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

#### ã‚¿ã‚¹ã‚¯3-1: v10å®Ÿè£…ãƒˆãƒ©ãƒƒã‚«ãƒ¼æ›´æ–°

**ãƒ•ã‚¡ã‚¤ãƒ«**: `25_4_2_v10_implementation_tracker.md`

Phase 1ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°:

```markdown
### Phase 1: s6-overlayå°å…¥ï¼ˆPID 1å¤‰æ›´ï¼‰
- [x] Dockerfileã«s6-overlayã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€ENTRYPOINTã‚’`/init`ã«å¤‰æ›´
- [x] `.devcontainer/s6-rc.d/` ã«ã‚µãƒ¼ãƒ“ã‚¹å®šç¾©ã‚’ä½œæˆ

**æ›´æ–°æ—¥**: 2026-01-09
**æ›´æ–°å†…å®¹**: ENTRYPOINTã‚’`/init`ã«å¤‰æ›´å®Œäº†ï¼ˆ25_6_12å®Ÿè£…å®Œäº†ï¼‰
```

#### ã‚¿ã‚¹ã‚¯3-2: 25_6_11æ¤œè¨¼ãƒˆãƒ©ãƒƒã‚«ãƒ¼æ›´æ–°

**ãƒ•ã‚¡ã‚¤ãƒ«**: `25_6_11_pid1_design_deviation_verification_tracker.md`

ã‚»ã‚¯ã‚·ãƒ§ãƒ³C-1, C-2ã‚’å®Œäº†ã¨ã—ã¦ãƒãƒ¼ã‚¯

#### ã‚¿ã‚¹ã‚¯3-3: å¤‰æ›´å±¥æ­´ã®è¨˜éŒ²

25_6_12ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã€Œ## 8. å®Ÿè£…å®Œäº†ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 

### Phase 4: ã‚³ãƒŸãƒƒãƒˆ

#### ã‚¿ã‚¹ã‚¯4-1: git add

```bash
git add .devcontainer/Dockerfile
git add .devcontainer/docker-entrypoint.sh
git add initiatives/20251229--dev-hub-concept/25_6_12_v10_completion_strategy.md
git add initiatives/20251229--dev-hub-concept/25_4_2_v10_implementation_tracker.md
git add initiatives/20251229--dev-hub-concept/25_6_11_pid1_design_deviation_verification_tracker.md
```

#### ã‚¿ã‚¹ã‚¯4-2: ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ

**commit-messages-guidelines.mdcã«å¾“ã„ã€3ã¤ã®å€™è£œã‚’ä½œæˆ**ï¼ˆmode-3ã§å®Ÿæ–½ï¼‰

---

## 8. ãƒªã‚¹ã‚¯ç®¡ç†

### ãƒªã‚¹ã‚¯1: s6-overlayã®ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•å¤±æ•—

**å½±éŸ¿åº¦**: é«˜
**ç™ºç”Ÿç¢ºç‡**: ä½

**ç·©å’Œç­–**:
- ã‚µãƒ¼ãƒ“ã‚¹å®šç¾©ã¯æ—¢ã«å®Œç’§ã«å®Ÿè£…æ¸ˆã¿ï¼ˆæ¤œè¨¼æ¸ˆã¿ï¼‰
- ãƒ“ãƒ«ãƒ‰æ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚Œã°å³åº§ã«æ¤œå‡ºå¯èƒ½

**ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯**:
```bash
git revert HEAD
docker compose -f docker-compose.yml -f docker-compose.dev-vm.yml build
```

### ãƒªã‚¹ã‚¯2: docker-entrypoint.sh Phase 1-5ã®å®Ÿè¡Œå¤±æ•—

**å½±éŸ¿åº¦**: ä¸­
**ç™ºç”Ÿç¢ºç‡**: ä½

**ç·©å’Œç­–**:
- Phase 1-5ã¯æ—¢å­˜ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ãã®ã¾ã¾ä½¿ç”¨
- s6-overlayã®oneshotã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã‚‹ã ã‘

**å¯¾å‡¦**:
- `docker logs`ã§ã‚¨ãƒ©ãƒ¼ç®‡æ‰€ã‚’ç‰¹å®š
- å¿…è¦ã«å¿œã˜ã¦ã‚µãƒ¼ãƒ“ã‚¹å®šç¾©ã‚’ä¿®æ­£

### ãƒªã‚¹ã‚¯3: supervisordã¾ãŸã¯process-composeã®èµ·å‹•å¤±æ•—

**å½±éŸ¿åº¦**: ä¸­
**ç™ºç”Ÿç¢ºç‡**: ä½

**ç·©å’Œç­–**:
- ã‚µãƒ¼ãƒ“ã‚¹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`.devcontainer/s6-rc.d/supervisord/run`ï¼‰ã¯æ—¢ã«å®Ÿè£…æ¸ˆã¿
- `/command/s6-svstat`ã§çŠ¶æ…‹ç¢ºèªå¯èƒ½

**å¯¾å‡¦**:
- s6-overlayã®ãƒ­ã‚°ã‚’ç¢ºèª: `docker exec <container> cat /run/s6-rc/servicedirs/supervisord/log/current`
- å¿…è¦ã«å¿œã˜ã¦ã‚µãƒ¼ãƒ“ã‚¹å®šç¾©ã‚’ä¿®æ­£

---

## 9. æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### ä»Šã™ãå®Ÿæ–½ï¼ˆPhase 1-4ï¼‰

1. **Dockerfileä¿®æ­£**ï¼ˆã‚¿ã‚¹ã‚¯1-1ï¼‰
2. **docker-entrypoint.shä¿®æ­£**ï¼ˆã‚¿ã‚¹ã‚¯1-2ï¼‰
3. **ãƒ“ãƒ«ãƒ‰ã¨æ¤œè¨¼**ï¼ˆã‚¿ã‚¹ã‚¯2-1ã€œ2-7ï¼‰
4. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ã¨ã‚³ãƒŸãƒƒãƒˆ**ï¼ˆã‚¿ã‚¹ã‚¯3-1ã€œ4-2ï¼‰

### æ¤œè¨¼å®Œäº†å¾Œï¼ˆå°†æ¥ï¼‰

- **25_6_10ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ‡ã‚Šæ›¿ãˆå•é¡Œã®å¯¾å¿œ**ï¼ˆåˆ¥é€”ï¼‰
- **docker-entrypoint.shå†…ã®sudoå‰Šé™¤æ¤œè¨**ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰

---

**ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€v10è¨­è¨ˆã®æ®‹ã‚Š1%ã‚’å®Œæˆã•ã›ã€s6-overlayçµ±åˆã‚’å®Œäº†ã™ã‚‹ãŸã‚ã®æˆ¦ç•¥ã¨å®Ÿè£…è¨ˆç”»ã‚’ç¤ºã™ã‚‚ã®ã§ã™ã€‚**
