# Q&A

## E-1. `repos/` の位置

以前の設計では `repos/` は **Docker Volume上** (`/home/<user>/repos/`) に配置し、`dev-platform/` のバインドマウント領域とは分離する想定でした。

この構成図だと `dev-platform/repos/` に見えます。これは意図的な変更ですか？

- **変更した場合**: I/Oパフォーマンスの懸念が復活します（特に`node_modules`）
- **表記上の問題だけ**: 「コンテナ内での見え方」と「Git管理対象」を分けて書く必要があるかも

=> するどい指摘ですね、おっしゃるとおりです。このディレクトリ構成のままdevcontainer で dev-platform を開くと各レポジトリがbindマウントされちゃうし意味ないですもんね。 **ここからが重要**: ただ、initiatives や foundations がプロダクトレポジトリの開発修正のコンテキストに大きく影響を及ぼすと思うのです。特にAI時代では、cursor や claude code などにそれらを読ませて開発修正タスクを進めたいですよね。なにか良い解決策はありますか？

## E-2. initiatives の命名規則

```
20251229--cost-analysis-for.../
```

- `--` ダブルハイフンはタイポ？
- 説明では「開始年月日-終了年月日-名前」とありますが、例には終了年月日がありません

想定する形式はどちら？
- `YYYYMMDD-name`（開始日のみ）
- `YYYYMMDD-YYYYMMDD-name`（開始-終了）

=> ああ、まだ進行中の initiative に関して終了日時を書いてない、ということを表現したかったです。命名に関してなにかいい案ありますか？

## E-3. 横断的なinitiative（_planning等）

先ほど議論した「定例・戦略・initiative立案」を入れる `_planning/` 的なものは、不要と判断しましたか？

=> はい、不要です。それも含めて initiative としたいです。

## D-1. **initiatives の中身の構造**（ `_overview.md`, `research/`, `meetings/`, `tasks/`, `decisions/` ）はテンプレートとして `foundations/` にガイドを置く？それとも各自自由？

-> 各自自由で

## D-2. **initiatives の粒度**：エピック単位？もう少し大きいプログラム単位？混在OK？

-> 自由で

## D-3. **initiatives の終了後**：完了した取り組みはどうする？

- そのまま残す（アーカイブ的に）
- `_overview.md` に「完了」と書くだけ
- 別の場所に移動（`archives/` など）

=> _overview でもいいですが、ディレクトリ名に終了日時が入ればそれでいいかと思います

## C-1. **`bin/`ディレクトリ**: ホスト側で叩くスクリプトは「UID/GIDを.envに吐く」程度に限定するなら、`bin/`という大げさな名前より`.devcontainer/host-setup.sh`的な1ファイルで十分では？

-> 私も同意。採用

## C-2. **`.gitkeep`**: `members/`を空で維持したいなら必要。ただしメンバーがすぐ自分のディレクトリを作るなら不要

-> 不要

## C-3, **workspace.code-workspaceの生成**: `post-create.sh`で動的に生成する？それとも手動管理？

-> 手動管理でよさそう

## B-1. 論理的整合性の確認と「ツッコミ」

### B-1-①「鶏と卵」問題：`devcontainer.json` の生成タイミング

* **現状の設計:** `host-setup.sh` がテンプレートから `devcontainer.json` を生成する。
* **ツッコミ:** VS Code は「フォルダーを開いた瞬間」に `.devcontainer/devcontainer.json` を探して、「コンテナで開きますか？」と聞いてきます。つまり、**VS Codeで開く前に、ターミナルで `host-setup.sh` を叩く儀式が必須**になります。
* これは「Cloneしてすぐ開発開始」というUXを少し損ないます。「Onboarding速度」のメリット（File 00, 10）とわずかに矛盾します。

* **対策:** これは許容すべきコストですが、`knowledge/onboarding.md` の最初の手順に **「VS Codeで開く前に必ずこれを叩け」** とデカデカと書く必要があります。

=> そうですね、それは間違いないと思います

### B-1-②「テンプレート乖離」問題：構成変更の伝播

* **現状の設計:** `.devcontainer.json.template` をGit管理し、実ファイルは `.gitignore` する。
* **ツッコミ:** 誰かが「便利な拡張機能」を追加して `template` を更新しPushしました。他のメンバーが `pull` しても、**手元の実ファイル（生成済みjson）は更新されません。**
* Git管理外なので差分にも気づきにくいです。結果として「Aさんのコンテナには拡張機能Xが入ってるのに、Bさんにはない」という、撲滅したはずの「環境差異」が復活します。

* **解決案:**
* `post-create.sh`（コンテナ内）または `bin/check-update.sh` 等で、「テンプレートと実ファイルのハッシュ値」を比較し、ズレていたら警告を出す仕組みを入れるのが安全です。

=> それはやりすぎかな。とりあえずは声掛けでいいと思います


### B-1-③「ハイブリッド・マウント」の明示が必要

* **現状の設計:**
* `dev-platform` リポジトリ自体（設定ファイル群）
* プロダクトコード (`/home/vscode/repos/...`)

* **ツッコミ:** ドキュメント上、ここが少し曖昧です。
* `dev-platform` 自体はホストから **バインドマウント** されます（VS Codeのデフォルト挙動）。
* `repos` は **Docker Volume** です。
* したがって、`members/` ディレクトリ（`dev-platform`内）での作業は **ホストのファイルシステム上** で行われます。

* **リスク:** もしメンバーが `members/` 以下で重い `npm install` を試そうとすると、I/O問題（File 12で懸念していたこと）が再発します。「`members/` はあくまでテキスト編集や軽いスクリプト用であり、巨大なビルド用ではない」という認識合わせが必要です。

=> それはするどいツッコミだね。まぁでも常駐させたり常用するようなものが出てくるならそれは members/** から外に出すべきだから一旦は許容しよう

### B-1-④ `workspace.code-workspace` の「手動管理」の限界

* **現状の設計:** マルチリポジトリへのショートカット定義は手動管理（File 16, 14）。
* **ツッコミ:**
* 新しく `product-C` が追加された時、`post-create.sh` は自動でCloneしてくれますが、`code-workspace` ファイルには自動で追加されません。
* 開発者は「Cloneされてるはずなのにエクスプローラーにない？」と混乱します。

* **方向性:**
* ここだけは「手動」を許容せず、`post-create.sh` の最後で **「現在 `repos/` にあるディレクトリ一覧をもとに `workspace.code-workspace` を再生成（または追記）する処理」** を入れるべきです。JSON操作なので `jq` コマンド等で自動化可能です。

- => Q. 大前提の確認ですが、 `workspace.code-workspace` はコミットしますよね？
    - => A. YES
        - 理由: これ自体が「チーム共通のナビゲーション（地図）」だからです。
        - 運用フロー:
            - 新しいリポジトリ product-C を追加する時、担当者は post-create.sh（クローン処理）に追記すると同時に、workspace.code-workspace にも追記してコミットします。
            - 他のメンバーは pull した後、VS Code上で「リロード」すれば新リポジトリが表示されます。
        - 注意点: 自動生成（jqなどで上書き）をやると、Git上で常に「変更あり」と表示されて邪魔になるため、手動管理＆コミット が正解です。

## B-2. 未解決の議論と方向性の提示

### B-2-A. 認証情報の「パススルー」問題

* **現状:** `host-setup.sh` でUID/GIDは解決しました。しかし、`post-create.sh` で `git clone` する際、**「GitHub/GitLabへの認証」** はどう行われますか？
* **課題:**
* コンテナビルド中や `postCreateCommand` 実行時には、ホスト側の SSH Agent がうまく渡らないケースがあります（特にWindows/WSLまたぎの場合など）。
* HTTPS クローンだとパスワードを聞かれて止まります。

* **方向性:**
* **SSH Agent Forwarding** が必須です。`devcontainer.json` で機能自体は有効化されますが、ホスト側のSSH Agentが起動している前提となります。
* `host-setup.sh` の中で `ssh-add -l` を実行し、鍵が登録されているかチェックする機構を入れると、「Cloneできない」トラブルを未然に防げます。

=> 大前提として、やはりホストOSと .ssh や .git のような認証系はバインドマウントがいいと思っています

- => Q. WSL での課題ってWindows OS側で開発しないって決め切っちゃえばいいと思うのですが、どうですか？
    - A. YES
        - 解説:
            - 従来のWindows（PowerShell/CMD）からDockerを使うと、ファイル権限（chmod 600問題）やパス形式の違いでバインドマウントが地獄になります。
            - WSL2 (Ubuntu等) の中から code . で起動する場合、それは実質 「Linux to Linux」 のマウントになるため、権限トラブルは起きません。
            - MacユーザーもLinuxベースなので、同様に問題なく動きます。
        - 結論:
            - .devcontainer.json で ~/.ssh と ~/.gitconfig をバインドマウントする設定を入れます。
            - knowledge/onboarding.md に 「Windowsユーザーは必ずWSL2上のUbuntu等からリポジトリを開くこと」 と明記します。

### B-2-B. シークレット管理（`.env`）の集約戦略

* **現状:** `host-setup.sh` はUID/GID用の `.env` を作りますが、各プロダクト（`product-A`, `product-B`）が必要とするAPIキーなどはどうしますか？
* **課題:**
* モノリスコンテナなので、全プロダクトの `.env` 管理が必要です。
* 各 `repos/product-X/.env` を手動で設定するのは「Onboarding速度」を下げます。

* **方向性:**
* **「共通秘密情報注入スクリプト」** の検討。
* 1Password CLI (`op`) や AWS Secrets Manager、あるいはチーム共有の `.env.shared` を暗号化して `dev-platform` に持たせ、セットアップ時に各リポジトリへ配布する仕組みがあると、Devin等のAIエージェントも即座にテストを実行できるようになります。

=> うーん、これは将来の話だから今はいいや