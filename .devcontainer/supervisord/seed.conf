# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Supervisord シード設定ファイル (seed.conf)
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#
# ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
# ■ 注意: 通常、開発者がこのファイルを編集する必要はありません。 ■
# ■ プロセスの追加・変更は workloads/supervisord/project.conf   ■
# ■ を編集してください。                                         ■
# ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
#
# このファイルは単なるダミーやスタブ以上の重要な役割を持っています。
#
# --------------------------------------------------------------------
# 役割1: ビルド時検証用のスタブ
# --------------------------------------------------------------------
# Dockerfileのビルド中に `supervisord -t` コマンドで構文チェックを行うために
# 必要です。この検証をパスするために、有効な設定ファイルとして存在します。
#
# --------------------------------------------------------------------
# 役割2: フォールバック機構（安全装置）としての本質的な役割
# --------------------------------------------------------------------
# こちらがこのファイルの最も重要な役割です。
#
# 【なぜ必要か？】
# 開発者が実運用設定ファイルである `workloads/supervisord/project.conf`
# を編集した際に、もし構文エラーがあったり、ファイル自体を誤って削除して
# しまった場合、コンテナが正常に起動しなくなる可能性があります。
#
# 【何を実現するか？】
# そのような場合でもコンテナが完全に停止するのを防ぎ、開発者が問題を
# 修正できる「セーフモード（復旧モード）」を提供します。
# コンテナ起動スクリプト (docker-entrypoint.sh) は、`project.conf` の
# 読み込みに失敗すると、自動的にこの `seed.conf` を読み込んで
# supervisord を起動します。
#
# 【このファイルにcode-serverが含まれる理由】
# フォールバック時に最低限の開発環境（= code-server）を起動するためです。
# これにより、開発者はブラウザ経由で code-server にアクセスし、
# 問題のある `project.conf` を直接編集・修正することが可能になります。
# もしこのファイルが空だった場合、コンテナには入れず、問題解決が
# 非常に困難になります。
#
# --------------------------------------------------------------------
# ■ 通常運用時とフォールバック時の挙動について
# --------------------------------------------------------------------
#
# Q. このファイルは通常運用では使われないのですか？
# A. はい、その通りです。
#
# Dockerコンテナ起動時、`docker-entrypoint.sh`スクリプトによって、
# 最初に実運用設定ファイルである `workloads/supervisord/project.conf` が
# 参照されます。
#
# この `seed.conf` ファイルが実行時に参照されるのは、
# `project.conf` が存在しない、または構文エラーがある場合のみです。
#
# そのため、このファイルと`project.conf`で `[program:code-server]` の
# ような記述が重複していても問題ありません。むしろ、フォールバック時に
# 最低限の環境を提供するために、その重複は意図されたものです。
#
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[supervisord]
nodaemon=true
user=root
logfile=/dev/stdout
logfile_maxbytes=0
pidfile=/var/run/supervisord.pid

[program:code-server]
command=code-server --bind-addr 0.0.0.0:4035 --auth password
user=%(ENV_UNAME)s

autostart=true
autorestart=false
priority=10
environment=CODE_SERVER_PORT="4035",HOME="/home/%(ENV_UNAME)s"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0